{% extends "base.html" %}
{% block title %}Mis Entregas{% endblock %}

{% block content %}
<div class="px-6">
  <h1 class="text-2xl font-semibold mb-4">Mis entregas asignadas</h1>

  <table class="min-w-full text-sm border-collapse">
    <thead class="bg-gray-100">
      <tr>
        <th class="px-4 py-2 text-left">ID</th>
        <th class="px-4 py-2 text-left">Cliente</th>
        <th class="px-4 py-2 text-right">Litros</th>
        <th class="px-4 py-2 text-left">Estatus</th>
        <th class="px-4 py-2 text-left">Chat</th>
        <th class="px-4 py-2 text-center">Acciones</th>
      </tr>
    </thead>

    <tbody>
    {% for order in orders %}
      <tr class="border-t">
        <td class="px-4 py-2">{{ order.id }}</td>
        <td class="px-4 py-2">{{ order.client.get_full_name }}</td>
        <td class="px-4 py-2 text-right">{{ order.quantity_liters }}</td>
        <td class="px-4 py-2">{{ order.get_status_display }}</td>
        <td class="px-4 py-2">
          <span class="text-gray-400">Chat no disponible</span>
        </td>
        <!-- Columna de acciones -->
        <td class="px-4 py-2 text-center">
          {% if order.get_status_display == "Asignado" %}
            <!-- Botón RECHAZAR -->
            <form method="post"
                  action="{% url 'orders_operator:reject' order.id %}"
                  class="inline">
              {% csrf_token %}
              <button type="submit"
        style="background:#dc2626;color:#fff;padding:4px 8px;border-radius:4px;font-size:0.75rem;font-weight:600;"
        onmouseover="this.style.background='#990c02'"
        onmouseout="this.style.background='#dc2626'">
  Rechazar
</button>
            </form>

            <!-- Botón MARCAR ENTREGADO -->
            <form method="post"
                  action="{% url 'orders_operator:deliver' order.id %}"
                  class="inline ml-2">
              {% csrf_token %}
              <button type="submit"
                      style="background:#16a34a;color:#fff;padding:4px 8px;border-radius:4px;font-size:0.75rem;font-weight:600;"
                      onmouseover="this.style.background='#4ade80'; this.style.color='#000000';"
                      onmouseout="this.style.background='#16a34a'; this.style.color='#fff';">
                Marcar&nbsp;entregado
              </button>

            </form>
          {% endif %}
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="6" class="px-4 py-6 text-center text-gray-500">
          Aún no tienes entregas.
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>

</div>
{% endblock %}
